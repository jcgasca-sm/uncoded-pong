<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UNCODED Pong – Stable + Play (Centered)</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

  :root{
    --frame:#b084f5;   /* marco lila */
    --pink:#FF2C9C;    /* jugador */
    --mint:#98FF98;    /* IA */
    --txt:#fff;
    --bg:#000;
  }

  /* Centrado global */
  html, body{
    margin:0; padding:0;
    height:100%;
    background:var(--bg);
    color:var(--txt);
    font-family:'Press Start 2P', monospace;
  }
  .shell{
    min-height:100svh; /* soporta mobile */
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:10px;
    text-align:center;
  }

  /* Marcadores y texto */
  #scoreboard, #instructions{ font-size:10px; }

  /* Contenedor del canvas + overlays */
  #game-container{
    position:relative;
    width:90vw; max-width:720px;
    margin:0 auto;
  }

  canvas{
    position:relative; z-index:1;  /* debajo de overlays */
    display:block; margin:0 auto;
    background:#000;                /* cancha negra */
    border:8px solid var(--frame);  /* marco lila */
    border-radius:10px;
    box-shadow:0 0 20px var(--frame);
    width:90vw; max-width:720px; height:auto;
    aspect-ratio:4/3;
  }

  /* Overlay PLAY NOW */
  #startOverlay{
    position:absolute; inset:0;
    display:flex; align-items:center; justify-content:center;
    pointer-events:auto; z-index:3;
  }
  .start-inner{
    display:flex; flex-direction:column; align-items:center; gap:14px;
    background:rgba(0,0,0,.25);
    padding:18px 22px; border-radius:12px;
  }
  .playNow{
    display:inline-flex; align-items:center; gap:10px;
    font-size:clamp(16px,3.8vw,28px);
    color:#ff2ca8; text-shadow:2px 2px #000;
    letter-spacing:2px;
    animation:blink 1.2s steps(2,end) infinite;
    cursor:pointer;
  }
  .triangle{
    width:0; height:0;
    border-left:14px solid #ff2ca8;
    border-top:8px solid transparent;
    border-bottom:8px solid transparent;
    filter:drop-shadow(1px 1px 0 #000);
  }
  @keyframes blink{ 0%,100%{opacity:1} 50%{opacity:.5} }

  /* Overlay final (logo + msg + restart) */
  #winWrap{
    position:absolute; left:50%; top:50%;
    transform:translate(-50%,-50%);
    width:85%;
    display:none; text-align:center;
    pointer-events:none; z-index:2;
  }
  #logo{
    width:140px; display:block; margin:0 auto 12px;
    opacity:0; transform:scale(.8); pointer-events:none;
  }
  #winMsg{ margin:6px 0 10px; font-size:clamp(12px,2.6vw,18px); line-height:1.6; }
  #restartBtn{
    display:inline-block; pointer-events:auto;
    padding:10px 14px; background:var(--frame); color:#000;
    border:none; border-radius:6px;
    font-family:'Press Start 2P', monospace;
    font-size:clamp(10px,2vw,12px);
    cursor:pointer; opacity:0; transform:translateY(6px);
  }
  #restartBtn:hover{ filter:brightness(1.1); }

  /* animaciones simples */
  @keyframes fadeInUp{0%{opacity:0;transform:translateY(8px) scale(.98)}100%{opacity:1;transform:translateY(0) scale(1)}}
  @keyframes popIn{0%{opacity:0;transform:scale(.6)}60%{opacity:1;transform:scale(1.15)}100%{opacity:1;transform:scale(1)}}
  .fade-in{animation:fadeInUp .35s ease-out forwards}
  .logo-in{animation:popIn .65s ease-out forwards}
</style>
</head>
<body>
  <div class="shell">
    <div id="scoreboard">Player: 0 | AI: 0</div>

    <div id="game-container">
      <canvas id="gameCanvas"></canvas>

      <!-- START overlay -->
      <div id="startOverlay" aria-hidden="false">
        <div class="start-inner" role="button" aria-label="Start game">
          <div class="playNow" id="playNowBtn" tabindex="0">
            <span class="triangle"></span>
            <span>PLAY&nbsp;&nbsp;NOW</span>
          </div>
          <div style="font-size:10px;color:#f0e130;opacity:.9">Move with mouse / touch</div>
        </div>
      </div>

      <!-- WIN overlay -->
      <div id="winWrap" aria-hidden="true">
        <img id="logo"
             src="https://cdn.shopify.com/s/files/1/0590/5583/3260/files/pixel_art_large_01eb3c2a-6722-418d-abfa-921e22e2c9a7.png?v=1754589799"
             alt="Uncoded Logo"/>
        <div id="winMsg"></div>
        <button id="restartBtn">RESTART</button>
      </div>
    </div>

    <div id="instructions">First to 10 wins!</div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const scoreboard = document.getElementById('scoreboard');

  const startOverlay = document.getElementById('startOverlay');
  const playNowBtn   = document.getElementById('playNowBtn');

  const winWrap   = document.getElementById('winWrap');
  const logoEl    = document.getElementById('logo');
  const winMsgEl  = document.getElementById('winMsg');
  const restartBtn= document.getElementById('restartBtn');

  /* ===== Tamaño responsive ===== */
  function resizeCanvas(){
    canvas.width  = canvas.offsetWidth;
    canvas.height = canvas.offsetWidth * 3/4;
  }
  resizeCanvas();
  window.addEventListener('resize', () => { resizeCanvas(); recalcUnits(); });

  let unit=1;
  function su(x){ return x*unit; }
  function recalcUnits(){
    unit = canvas.width/640;
    paddleHeight = su(100);
    paddleWidth  = su(10);
    ball.radius  = su(7);
  }

  /* ===== Estado del juego (versión estable) ===== */
  let paddleHeight, paddleWidth, playerY, aiY;
  let playerScore, aiScore, winScore = 10;
  let gameOver = false;
  let gameStarted = false;

  const PLAYER_COLOR = "#FF2C9C";
  const AI_COLOR     = "#98FF98";
  const NET_COLOR    = "#b084f5";

  const ball = { x:0, y:0, radius:7, dx:0, dy:0 };

  function initGame(){
    recalcUnits();
    playerY = canvas.height/2;
    aiY     = canvas.height/2;
    ball.x  = canvas.width/2;
    ball.y  = canvas.height/2;
    ball.dx = su(3.5) * (Math.random()>0.5?1:-1);
    ball.dy = su(3.5) * (Math.random()>0.5?1:-1);
    playerScore = 0; aiScore = 0;
    gameOver = false; gameStarted = false;

    // overlays
    winWrap.style.display = 'none';
    startOverlay.style.display = 'flex';
    scoreboard.textContent = `Player: ${playerScore} | AI: ${aiScore}`;
  }

  /* ===== Control del jugador (mouse + touch) ===== */
  function pointerToCanvasY(e){
    const rect = canvas.getBoundingClientRect();
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    const half = paddleHeight/2;
    let y = clientY - rect.top;
    // límites para no salir del marco
    playerY = Math.max(half, Math.min(canvas.height - half, y));
  }

  // Ratón (solo cuando el juego ya inició)
  canvas.addEventListener('mousemove', (e) => {
    if (!gameStarted || gameOver) return;
    pointerToCanvasY(e);
  });

  // Táctil (solo mueve si ya empezó)
  canvas.addEventListener('touchstart', (e) => {
    if (!gameStarted || gameOver) return;
    pointerToCanvasY(e);
  }, {passive:true});

  canvas.addEventListener('touchmove', (e) => {
    if (!gameStarted || gameOver) return;
    e.preventDefault(); // evita scroll al jugar
    pointerToCanvasY(e);
  }, {passive:false});

  // Botón PLAY (click/teclado)
  function startGame(){
    if (gameStarted) return;
    gameStarted = true;
    startOverlay.style.display = 'none';
  }
  playNowBtn.addEventListener('click', startGame);
  playNowBtn.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') startGame();
  });

  /* ===== Dibujo ===== */
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // red/punteo central
    ctx.fillStyle = NET_COLOR;
    for(let y=0; y<canvas.height; y+=su(30)){
      ctx.fillRect(canvas.width/2 - su(1), y, su(2), su(15));
    }

    // palas
    ctx.fillStyle = PLAYER_COLOR;
    ctx.fillRect(su(10), playerY - paddleHeight/2, paddleWidth, paddleHeight);

    ctx.fillStyle = AI_COLOR;
    ctx.fillRect(canvas.width - su(10) - paddleWidth, aiY - paddleHeight/2, paddleWidth, paddleHeight);

    // bola
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);
    ctx.fillStyle = "#fff";
    ctx.fill();
  }

  /* ===== Lógica ===== */
  function resetBall(){
    ball.x = canvas.width/2;
    ball.y = canvas.height/2;
    ball.dx = su(3.5) * (Math.random()>0.5?1:-1);
    ball.dy = su(3.5) * (Math.random()>0.5?1:-1);
  }

  function update(){
    if (gameOver || !gameStarted) return;

    // bola
    ball.x += ball.dx;
    ball.y += ball.dy;

    if (ball.y + ball.radius > canvas.height || ball.y - ball.radius < 0){
      ball.dy = -ball.dy;
    }

    // colisión jugador
    if (ball.x - ball.radius < su(10) + paddleWidth &&
        ball.y > playerY - paddleHeight/2 &&
        ball.y < playerY + paddleHeight/2){
      ball.dx = Math.abs(ball.dx);
      ball.x  = su(10) + paddleWidth + ball.radius;
    }

    // colisión IA
    if (ball.x + ball.radius > canvas.width - su(10) - paddleWidth &&
        ball.y > aiY - paddleHeight/2 &&
        ball.y < aiY + paddleHeight/2){
      ball.dx = -Math.abs(ball.dx);
      ball.x  = canvas.width - su(10) - paddleWidth - ball.radius;
    }

    // puntaje
    if (ball.x - ball.radius < 0){ aiScore++;     resetBall(); }
    else if (ball.x + ball.radius > canvas.width){ playerScore++; resetBall(); }

    // IA fácil (misma de la estable)
    const aiSpeed = su(2);
    if (aiY < ball.y - su(15)) aiY += aiSpeed;
    else if (aiY > ball.y + su(15)) aiY -= aiSpeed;

    // marcador
    scoreboard.textContent = `Player: ${playerScore} | AI: ${aiScore}`;

    // fin
    if (playerScore === winScore || aiScore === winScore){
      gameOver = true;
      winMsgEl.innerHTML = (playerScore === winScore)
        ? 'CONGRATS! YOU WON 10% DISCOUNT!<br/>USE CODE: <strong>NSTLG10</strong>'
        : 'Keep trying...';
      winWrap.style.display = 'block';
      logoEl.classList.add('logo-in');
      winMsgEl.classList.add('fade-in');
      restartBtn.classList.add('fade-in');
    }
  }

  function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
  }

  // Restart
  restartBtn.addEventListener('click', () => {
    initGame();
  });

  // Init
  initGame();
  loop();
})();
</script>
</body>
</html>
